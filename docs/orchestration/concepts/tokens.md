# Tokens <Badge text="Cloud"/>

## Token Types

### User

User-based API keys function as personal access keys. These keys have very few permissions on their own, but can be used to authenticate with the Cloud API. Once authenticated, user-based keys can be used to generate short-lived JWT auth tokens for any tenant the user belongs to. These keys inherit any permissions the user has in that tenant, allowing full API access. The Client manages the process of provisioning and refreshing these tokens.

### Service Account

Service Account-based API keys are used for processes like the Prefect Agent, which require the ability to execute flows on behalf of a tenant. Service Account keys are attached to their cross-tenant account, as opposed to an individual user. Consequently, they can only be generated by tenant admins.

## Creating Tokens

### UI

To create a service account key in the UI navigate to Team Settings -> Service Accounts.

![token screen](/token_screen.png)

Click on _Create API Key_. Give the key a name and optionally an expiration.

![token naming](/token_naming.png)

After you click create you will be prompted with the key which you can copy and store in a safe place. Then you should see the key added to your list of keys for that account.

![token_created](/token_created.png)

### CLI

To create a token with the CLI run the `create-token` command with the desired token name and scope. For more information on how to use the CLI go [here](cli.html).

```
$ prefect auth create-token -n my-runner-token -s RUNNER
```

### GraphQL

To create a token using GraphQL execute the `create_api_key` mutation against `https://api.prefect.io`. For more information on how to use the GraphQL API go [here](api.html).

```graphql
mutation {
  create_api_key(input: { user_id: <user_id>, name: "my-runner-token" }) {
    token
  }
}
```

## Revoking Keys

### UI

To revoke a token in the UI navigate to Team Settings -> Service Accounts. On your list of API keys click the trash bin icon next to any key in order to delete it. A confirmation box should appear asking if you are sure you want to delete the key.

![token delete](/token_delete.png)

### CLI

To revoke a key with the CLI run the `revoke-token` command with the ID of the key you want to revoke. For information on how to find a key's ID look under [Querying for Key Information](tokens.html#querying-for-token-information).

```
$ prefect auth revoke-token -i $MY_TOKEN_ID
```

### GraphQL

To revoke a key using GraphQL execute the `delete_api_key` mutation against `https://api.prefect.io`. For information on how to find a key's ID look under [Querying for Key Information](tokens.html#querying-for-token-information).

```graphql
mutation {
  delete_api_key(input: { key_id: "MY_KEY_ID" }) {
    success
  }
}
```

## Querying for Key Information

To query for information about a specific key with GraphQL, execute the following query against `https://api.prefect.io`. This will allow you to query for key information, however it never returns the value of the key itself.

```graphql
query {
  auth_api_key {
    id
    name
    expires_at
  }
}
```

## Use and Persistence of Service Account Keys

Service account keys are generally used by Prefect Agents and flows to communicate with Prefect Cloud. A service account key is provided to an agent at start and every time it deploys a flow to run it is given that key that it then uses to communicate state back to Prefect Cloud. This means that whenever a service account key is revoked, all agents and flows which are currently using it are unable to communicate with Prefect Cloud and will need to be started with a new key in order to resume their work.

There are a few ways in which you can give a service account key to an agent. Each method has an extra level of persistence.

- Provide the key when the agent is started via the CLI. This method means the key will need to be provided each time the agent is started.

```
$ prefect agent <AGENT TYPE> start -t KEY_VALUE
```

- Specify the key as an environment variable. This method means the key will only be available to processes which have the variable set.

```bash
$ export PREFECT__CLOUD__AGENT__AUTH_TOKEN=KEY_VALUE
```

- Manually save your key in `$HOME/.prefect/config.toml`. This method ensures that the key will be available at all times if it is not overridden.

```toml
[cloud.agent]
auth_token = KEY_VALUE
```

For information on the use of your user-scoped API keys visit the [Prefect Cloud API](api.html) page.

# Flow orchestration with Orion

Up to this point, we've demonstrated running flows and tasks in a local environment using the ephemeral Orion API. As you've seen, it's possible to run flexible, sophisticated workflows in this way without any further configuration.

Many users find running flows locally is useful for development, testing, and one-off or occasional workflow execution.

Where you begin leveraging the full power of Prefect is flow orchestration &mdash; building, running, and monitoring your workflows at scale.

Orchestration with Prefect helps you schedule and deploy workflows that run in the environments best suited to their execution. Orchestration helps you prevent and recover from failures, and view and manage the status of workflows, making your workflow resilient, observable, and interactive. 

## The components of Orion

Designing workflows with Prefect starts with a few basic building blocks that you've already seen: flows and tasks. 

Creating and running _orchestrated_ workflows takes advantage of some additional Prefect Orion components. 

- [Orion's API server](#the-orion-api-server) receives state information from workflows and provides flow run instructions for executing deployments.
- Orion's database provides a persistent metadata store that holds flow and task run history.
- Orion's UI provides a control plane for monitoring, configuring, analyzing, and even creating ad-hoc runs of your Prefect workflows.
- Storage for flow and task data lets you configure a persistent store for flow code and flow and task results.
- Work queues and agents bridge the serverâ€™s orchestration environment with a your execution environments, organizing work that agents can pick up to execute.

These Orion components and services enable you to form what we call a dedicated _orchestration environment_. The same components and services enable you to orchestrate flows with either the open-source Orion API server or Prefect Cloud.

Let's take a closer look at each component.

## The Orion API server

The Orion API server can be stood up with a single CLI command:

```bash
$ prefect orion start --no-services
```

There are numerous ways to begin exploring the API:

- Navigate to [http://127.0.0.1:4200/docs](http://127.0.0.1:4200/docs) (or your corresponding API URL) to see the autogenerated Swagger API documentation.
- Navigate to [http://127.0.0.1:4200/redoc](http://127.0.0.1:4200/redoc) (or your corresponding API URL) to see the autogenerated Redoc API documentation.
- Instantiate [an asynchronous `OrionClient`][prefect.client] within Python to send requests to the API.

During normal operation is it not expected that you will need to interact with the API directly, as this is handled automatically for you within the Python client and the UI.  Most users will spin up everything all at once with `prefect orion start`.

### The Orion scheduler


## The Orion metadata database

The database is the persistent layer that powers many of the features and functionality of Orion.  Currently Orion supports the following databases:

- SQLite: the default in Orion, and our recommendation for lightweight, single-server deployments. SQLite requires essentially no setup.
- PostgreSQL: best for connecting to external databases, but does require additional setup (such as Docker).

When you first install Orion, your database will be located at `~/.prefect/orion.db`. To configure this location, you can specify a connection URL with the `PREFECT_ORION_DATABASE_CONNECTION_URL` environment variable:

```bash
$ export PREFECT_ORION_DATABASE_CONNECTION_URL="sqlite+aiosqlite:////full/path/to/a/location/orion.db"
```

!!! tip "In-memory databases"
    One of the benefits of SQLite is in-memory database support. In-memory databases are only supported in Orion for testing purposes and are not compatible with multiprocessing.  
    
    To use an in-memory SQLite database, set the following environment variable:

    ```bash
    $ export PREFECT_ORION_DATABASE_CONNECTION_URL="sqlite+aiosqlite:///file::memory:?cache=shared&uri=true&check_same_thread=false"
    ```

!!! danger "Migrations"
    Recall that Orion is available as [a technical preview](/faq/#why-is-orion-a-technical-preview). This means many aspects of Orion's schema are still under active development and therefore upgrades should be considered destructive.  As it nears official release, database migration guides and tooling will be available and documented.

If at any point in your testing you'd like to reset your database, run the CLI command:  

```bash
$ prefect orion database reset
```

This will completely clear all data and reapply the schema.




## The Orion UI and Dashboard

The Orion Dashboard comes prepackaged with the API when you serve it. By default it can be found at `http://127.0.0.1:4200/`:

<figure markdown=1>
![](/img/tutorials/ui-component.png){: max-width=600px}
</figure>

The dashboard allows you to track and manage your flows, runs, and deployments and additionally allows you to filter by names, tags, and other metadata to quickly find the information you are looking for.

!!! tip "Additional Reading"
    To learn more about the concepts presented here, check out the following resources:

    - [Orion REST API Specification](/api-ref/rest/)
    - [Deployments](/concepts/deployments/)


## Storage for flow and task data

## Work queues and agents

Orion also ships with a collection of services that are also run with `prefect orion start`:

- The Orion agent is a lightweight process responsible for submitting both scheduled and manually triggered deployments as sub-processes.
- The Orion scheduler prepares and creates runs for any scheduled deployments.
- The Orion `MarkLateRuns` service which updates late runs by placing them in a `Late` state.
